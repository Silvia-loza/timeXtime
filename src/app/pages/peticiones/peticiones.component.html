<body>
  <app-head></app-head>
  
  <div class="container" id="container1">
    <div class="row">
      <div class="col-lg-4">
        <img src ="{{user[0].foto}}" id="id_perfil">
        <h2 id="nombre">{{user[0].nombre}} {{user[0].primer_apellido}} {{user[0].segundo_apellido}}</h2>
        <div class="container" id="estrellas" *ngIf="user[0].valoracion === 1">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
        </div>
        <div class="container" id="estrellas" *ngIf="user[0].valoracion === 2">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
        </div>
        <div class="container" id="estrellas" *ngIf="user[0].valoracion === 3">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
        </div>
        <div class="container" id="estrellas" *ngIf="user[0].valoracion === 4">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
        </div>
        
        <div class="container" id="estrellas" *ngIf="user[0].valoracion === 5">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
          <img src="..\..\..\assets\estrella.png" alt="" class="estrella">
        </div>
        <h1 id="tiempo">{{user[0].monedas}} <img src ="../../../assets/reloj-de-arena.png" id="id_tiempo"></h1>
        <button routerLink="/nueva-tarea" type="button" id= "nueva_peticion"class="btn btn-light"><i class="fa fa-plus-circle" id="plus"></i> Nueva petición</button>
      </div>
      <div class="col-lg-8">
        <button type="button" id="tareas_realizadas" class="btn btn-light" (click) = "mostrarPeticionesPub()">Peticiones publicadas</button>
        <button type="button" id="tareas_publicadas" class="btn btn-light" (click) = "mostrarPeticionesSol()">Peticiones solicitadas</button>

        <div class="container" id="container2">

          <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
      
      
            <div *ngIf="peticiones!=null">
      
              <div class="row">
      
                <div class="col-lg-12">
      
                  <div *ngFor="let peticion of peticiones; let i = index">
                    
                    <div class="card " id="card1">
                      <img class="card-img-top" src="{{peticion.foto}}" alt="Card image cap">
                      
                      <div class="card-body">
                        <h6 class="zona">{{peticion.localizacion}}</h6>
                        <h6 class="fecha">{{peticion.fecha_finalizacion | date:'dd/MM/yyyy'}}</h6>
                        <br>
                        <br>
                        <h5 class="card-title">{{peticion.titulo}}</h5>
                        <p class="card-text">{{peticion.descripcion}} </p>
                        
                        <img class="reloj" src="..\..\..\assets\reloj-de-arena.png" alt="">
                        <h6 class="monedas">{{peticion.precio}}</h6>
              
                        <div *ngIf="petUsu[i].id_creador === user[0].id_usuario">

                          <div *ngIf="peticiones[i].estado === 'sin solicitar'">

                            <button class="btn btn-warning solicitar" id="botonx" disabled>{{peticiones[i].estado}}</button>
                          </div>

                          <div *ngIf="peticiones[i].estado === 'solicitada'">

                            <button class="btn btn-success solicitar" id="botonx" (click)="openModal(template)">{{peticiones[i].estado}}</button>
                          </div>

                          <div *ngIf="peticiones[i].estado === 'aceptada'">

                            <button class="btn btn-success solicitar" id="botonx" disabled>{{peticiones[i].estado}}</button>
                          </div>

                          <div *ngIf="peticiones[i].estado === 'realizada'">

                            <button class="btn btn-primary solicitar" id="botonx" (click)="openModal(template2)">{{peticiones[i].estado}}</button>
                          </div>

                          <div *ngIf="peticiones[i].estado === 'expirada'">

                            <button class="btn btn-danger solicitar" id="botonx" disabled>{{peticiones[i].estado}}</button>
                          </div>

                          
                        </div>

                        <div *ngIf="petUsu[i].id_creador != user[0].id_usuario">

                          <div *ngIf="peticiones[i].estado === 'solicitada'">

                            <button class="btn btn-warning solicitar" id="botonx" disabled>{{peticiones[i].estado}}</button>

                          </div>

                          <div *ngIf="peticiones[i].estado === 'aceptada'">

                            <button class="btn btn-primary solicitar" id="botonx" (click)="openModal(template1)">{{peticiones[i].estado}}</button>

                          </div>

                          <div *ngIf="peticiones[i].estado === 'realizada'">

                            <button class="btn btn-primary solicitar" id="botonx" disabled>{{peticiones[i].estado}}</button>

                          </div>

                          
                    
                        </div>
                        <label id = "anadirFoto" for="photo" (click) = "mostrarPeticion(i)">Editar
                        </label>
 
                
                        <ng-template #template class="elmodal">
                          <div class="modal-header">
                            <h4 class="modal-title pull-center" id="h4filtro">Alguien ha solicitado tu petición</h4>
                            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                              <span aria-hidden="true">&times;</span>
                        
                            </button>
                          </div>
                          <div class="modal-body">
                      
                            <div> 
                                                 
                              <p>(Nombre_usuario del solicitante) ha solicitado tu petición "{{peticiones[i].titulo}}". Haz click en aceptar si quieres que la lleve a cabo o haz click en rechazar si quieres que la petición vuelva al muro y la haga otra persona.</p>        
                              
                                                                                
                            </div>

                            <button class="btn btn-outline-success" (click)="aceptarSolicitud(peticiones[i])" (click)="modalRef.hide()"> <i class="fa fa-check-circle"></i> Aceptar</button>
                            <button class="btn btn-outline-danger" id="rechazar" (click)="rechazarSolicitud(peticiones[i])" (click)="modalRef.hide()"> <i class="fa fa-times-circle"></i> Rechazar</button>
                            
                          </div>
                        </ng-template>

                        <ng-template #template1 class="elmodal">
                          <div class="modal-header">
                            <h4 class="modal-title pull-center" id="h4filtro">¿Ya has realizado la petición?</h4>
                            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                              <span aria-hidden="true">&times;</span>
                        
                            </button>
                          </div>
                          <div class="modal-body">
                      
                            <div> 
                                                 
                              <p>Por favor, asegúrate de haber completado la petición antes de hacer click en "Sí". Ten en cuenta que en caso de que no se haya completado la petición, no recibirás tus monedas</p>        
                              
                                                                                
                            </div>

                            <button class="btn btn-outline-success" (click)="realizarSolicitud(peticiones[i])"(click)="modalRef.hide()"> <i class="fa fa-check-circle"></i> Sí</button>
                            <button class="btn btn-outline-danger" id="rechazar" (click)="modalRef.hide()"> <i class="fa fa-times-circle"></i> No</button>
                            
                          </div>
                        </ng-template>

                        <ng-template #template2 class="elmodal">
                          <div class="modal-header">
                            <h4 class="modal-title pull-center" id="h4filtro">¡Petición completada!</h4>
                            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                              <span aria-hidden="true">&times;</span>
                        
                            </button>
                          </div>
                          <div class="modal-body">
                      
                            <div> 
                                                 
                              <p>Parece que (Nombre_usuario del solicitante) ha completado tu petición "{{peticiones[i].titulo}}". Por favor, asegúrate de que la petición se ha completado correctamente antes de continuar.</p>        
                              
                                                                                
                            </div>

                            <button class="btn btn-outline-success" (click)="aceptarSolicitud(peticiones[i])" (click)="modalRef.hide()"> <i class="fa fa-check-circle"></i> Aceptar</button>
                            <button class="btn btn-outline-danger" id="rechazar" (click)="rechazarSolicitud(peticiones[i])" (click)="modalRef.hide()"> <i class="fa fa-times-circle"></i> Rechazar</button>
                            
                          </div>
                        </ng-template>
                  

                      </div>
                    </div>
                  </div>
      
                </div>
      
              </div>
          
            </div>
      
          </div>
      
        </div>
      </div>
      
    </div>
  </div>


</body>

